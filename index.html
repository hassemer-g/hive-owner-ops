<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Operations Toolbox</title>
    <style>

body {
    font-family: Arial, sans-serif;
    margin: 0 auto;
    padding: 5%;
    box-sizing: border-box;
    line-height: 1.6;
    max-width: 500px; 
    text-align: center;
    background-color: #121212; 
    color: #e0e0e0; 
}

h1 {
    font-size: 1.8rem;
    text-align: center;
    margin-bottom: 5%;
    color: #ffffff; 
}

h1 a {
    color: green;
    text-decoration: none;
}

h1 a:hover {
    color: lightgreen;
}

.hidden {
    display: none;
}

.form-group {
    margin-bottom: 5%;
}

.subtitle {
    text-align: center;
    font-size: 1rem;
    color: #b0b0b0; 
    margin-bottom: 20px;
    white-space: normal;  
    display: block;
}
.subtitle a {
    color: green;
    text-decoration: none;
}

.subtitle a:hover {
    color: lightgreen;
}

label {
    font-size: 1rem;
    font-weight: bold;
    margin-bottom: 2%;
    display: block;
}

input {
    width: 100%;
    font-size: 1rem;
    padding: 3%;
    margin-top: 2%;
    border: 1px solid #333; 
    border-radius: 5px;
    box-sizing: border-box;
    background-color: #1e1e1e; 
    color: #ffffff; 
}

input:focus {
    outline: none;
    border-color: lightgrey;
    box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
}

button {
    padding: 3%;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 5%;
    width: 90%;
    max-width: 90%;
    display: block;
    margin-left: auto;
    margin-right: auto;
    background-color: darkorange;
    color: #ffffff; 
}

button:disabled {
    background-color: #555; 
    color: #ccc;
    cursor: not-allowed;
}

button:enabled {
    background-color: darkorange;
    color: white;
}

.word-wrap {
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-word;
    max-width: 100%;
    display: block;
    padding: 2%;  
    border-radius: 2%;  
    background-color: #1e1e1e; 
    color: #e0e0e0; 
}

.checkbox-container {
    display: flex;
    flex-direction: row; 
    align-items: center; 
    justify-content: flex-start; 
    width: 100%; 
    margin-top: 2%;
}

.checkbox-container input[type="checkbox"] {
    width: auto;
    height: auto;
    margin: 0; 
    margin-right: 2%; 
    flex-shrink: 0; 
}

.checkbox-container label {
    font-size: 0.85rem;
    line-height: 1.2;
    text-align: left;
    flex-grow: 1; 
    display: inline-block;
    white-space: normal; 
    width: 100%;
    margin: 0; 
    color: #e0e0e0; 
}

input[type="checkbox"]:checked {
    accent-color: green;
}

.footer {
    text-align: center;
    margin-top: 5%;
    font-size: 0.9rem;
    color: #b0b0b0;
}

.footer a {
    color: green;
    text-decoration: none;
}

.footer a:hover {
    color: lightgreen;
}

.disclaimer {
    font-size: 0.8rem;
}

.disclaimer .highlight {
    color: red;
}

#resultMessage {
    margin-top: 5%;
    font-size: 0.9rem;
    font-family: monospace;
}

#explicitConfirmationLock:checked {
    accent-color: red;
}

#submitButtonLock:enabled {
    background-color: red;
    color: white;
}


@media screen and (min-width: 768px) {
    body {
        padding: 2%;
    }

    h1 {
        font-size: 1.8rem;
    }

    button {
        max-width: 450px;
        margin: 2% auto;
        display: block;
    }

    #resultMessage {
        max-width: 500px;
        margin: 0 auto;
    }
}

        
    </style>
    
    <script src="https://unpkg.com/@hiveio/dhive@latest/dist/dhive.js" defer></script>
    
    <script defer>


document.addEventListener("DOMContentLoaded", () => {
    
    const client = new dhive.Client([
        "https://api.hive.blog",
        "https://api.openhive.network",
        "https://anyx.io",
        "https://api.deathwing.me",
        "https://hive-api.arcange.eu",
        "https://rpc.mahdiyari.info",
    ]);

    
    const accountNameUpd = document.getElementById("accountNameUpd");
    const newPublicOwnerKey1Upd = document.getElementById("newPublicOwnerKey1Upd");
    const useTwoPublicOwnerKeysUpd = document.getElementById("useTwoPublicOwnerKeysUpd");
    const secondPublicOwnerKeyGroupUpd = document.getElementById("secondPublicOwnerKeyGroupUpd");
    const newPublicOwnerKey2Upd = document.getElementById("newPublicOwnerKey2Upd");
    const newPublicActiveKeyUpd = document.getElementById("newPublicActiveKeyUpd");
    const newPublicPostingKeyUpd = document.getElementById("newPublicPostingKeyUpd");
    const newPublicMemoKeyUpd = document.getElementById("newPublicMemoKeyUpd");
    const privateOwnerKey1Upd = document.getElementById("privateOwnerKey1Upd");
    const signWithTwoOwnerKeysUpd = document.getElementById("signWithTwoOwnerKeysUpd");
    const secondPrivateKeyGroupUpd = document.getElementById("secondPrivateKeyGroupUpd");
    const privateOwnerKey2Upd = document.getElementById("privateOwnerKey2Upd");
    const submitButtonUpd = document.getElementById("submitButtonUpd");
    const resultMessageUpd = document.getElementById("resultMessageUpd");

    
    const accountNameChgRec = document.getElementById("accountNameChgRec");
    const newRecoveryAccountChgRec = document.getElementById("newRecoveryAccountChgRec");
    const privateOwnerKey1ChgRec = document.getElementById("privateOwnerKey1ChgRec");
    const signWithTwoOwnerKeysChgRec = document.getElementById("signWithTwoOwnerKeysChgRec");
    const secondPrivateKeyGroupChgRec = document.getElementById("secondPrivateKeyGroupChgRec");
    const privateOwnerKey2ChgRec = document.getElementById("privateOwnerKey2ChgRec");
    const submitButtonChgRec = document.getElementById("submitButtonChgRec");
    const resultMessageChgRec = document.getElementById("resultMessageChgRec");

    
    const accountNameExecRec = document.getElementById("accountNameExecRec");
    const newPrivateOwnerKeyExecRec = document.getElementById("newPrivateOwnerKeyExecRec");
    const previousPrivateOwnerKey1ExecRec = document.getElementById("previousPrivateOwnerKey1ExecRec");
    const previousPrivateOwnerKey2ExecRec = document.getElementById("previousPrivateOwnerKey2ExecRec");
    const signWithTwoOwnerKeysExecRec = document.getElementById("signWithTwoOwnerKeysExecRec");
    const secondPrivateKeyGroupExecRec = document.getElementById("secondPrivateKeyGroupExecRec");
    const submitButtonExecRec = document.getElementById("submitButtonExecRec");
    const resultMessageExecRec = document.getElementById("resultMessageExecRec");

    
    const accountNameLock = document.getElementById("accountNameLock");
    const privateOwnerKey1Lock = document.getElementById("privateOwnerKey1Lock");
    const signWithTwoOwnerKeysLock = document.getElementById("signWithTwoOwnerKeysLock");
    const secondPrivateKeyGroupLock = document.getElementById("secondPrivateKeyGroupLock");
    const privateOwnerKey2Lock = document.getElementById("privateOwnerKey2Lock");
    const explicitConfirmationLock = document.getElementById("explicitConfirmationLock");
    const submitButtonLock = document.getElementById("submitButtonLock");
    const resultMessageLock = document.getElementById("resultMessageLock");


    
    function validateAccountNameStructure(accountName) {
        const accountNameRegex = /^[a-z](([a-z0-9-]+)?[a-z0-9])?(\.[a-z](([a-z0-9-]+)?[a-z0-9])?)*$/;
        
        const validDotPlacement = !accountName.includes(".") || accountName.split(".").every(part => part.length >= 3);
        
        const noDotFollowedByHyphenOrNumber = !/\.[0-9-]/.test(accountName);
        return (
            accountName.length >= 3 &&
            accountName.length <= 16 &&
            accountNameRegex.test(accountName) &&
            validDotPlacement &&
            noDotFollowedByHyphenOrNumber &&
            !accountName.includes("-.")
        );
    }

    
    function validateAccountInput(inputField, submitButton) {
        const accountName = inputField.value.trim();
        if (accountName === "") {
            inputField.style.borderColor = "";
            submitButton.disabled = true;
            return;
        }
        const correctNameFormat = validateAccountNameStructure(accountName);
        inputField.style.borderColor = correctNameFormat ? "" : "red";
        
    }


    
    
    function validateAccountUpdateForm() {
        const accountName = accountNameUpd.value.trim();
        const newPublicOwnerKey1 = newPublicOwnerKey1Upd.value.trim();
        const newPublicOwnerKey2 = newPublicOwnerKey2Upd?.value.trim() || ""; 
        const privateOwnerKey1 = privateOwnerKey1Upd.value.trim();
        const privateOwnerKey2 = privateOwnerKey2Upd?.value.trim() || ""; 

        
        const allKeysFilled = [newPublicActiveKeyUpd, newPublicPostingKeyUpd, newPublicMemoKeyUpd].every(
            (input) => input?.value.trim() !== "" 
        );

        
        let isValid = accountName && validateAccountNameStructure(accountName);

        
        isValid = isValid && privateOwnerKey1 && allKeysFilled;

        
        if (useTwoPublicOwnerKeysUpd.checked) {
            const ownerKeys = [newPublicOwnerKey1, newPublicOwnerKey2].filter(Boolean); 

            
            isValid = isValid && ownerKeys.length === 2 && newPublicOwnerKey1 !== newPublicOwnerKey2;
        } else {
            isValid = isValid && newPublicOwnerKey1 !== ""; 
        }

        
        if (signWithTwoOwnerKeysUpd.checked) {
            isValid = isValid && privateOwnerKey1 !== privateOwnerKey2 && privateOwnerKey2 !== "";
        }

        
        submitButtonUpd.disabled = !isValid;
    }

    
    if (useTwoPublicOwnerKeysUpd) {
        useTwoPublicOwnerKeysUpd.addEventListener("change", () => {
            if (secondPublicOwnerKeyGroupUpd) {
                secondPublicOwnerKeyGroupUpd.style.display = useTwoPublicOwnerKeysUpd.checked ? "block" : "none";
            }
            if (newPublicOwnerKey2Upd) newPublicOwnerKey2Upd.value = "";
            validateAccountUpdateForm(); 
        });
    }

    
    if (signWithTwoOwnerKeysUpd) {
        signWithTwoOwnerKeysUpd.addEventListener("change", () => {
            if (secondPrivateKeyGroupUpd) {
                secondPrivateKeyGroupUpd.style.display = signWithTwoOwnerKeysUpd.checked ? "block" : "none";
            }
            if (privateOwnerKey2Upd) privateOwnerKey2Upd.value = "";
            validateAccountUpdateForm(); 
        });
    }

    
    accountNameUpd.addEventListener("input", () => validateAccountInput(accountNameUpd, submitButtonUpd));

    
    accountNameUpd.addEventListener("input", validateAccountUpdateForm);
    newPublicOwnerKey1Upd.addEventListener("input", validateAccountUpdateForm);
    newPublicOwnerKey2Upd.addEventListener("input", validateAccountUpdateForm);
    newPublicActiveKeyUpd.addEventListener("input", validateAccountUpdateForm);
    newPublicPostingKeyUpd.addEventListener("input", validateAccountUpdateForm);
    newPublicMemoKeyUpd.addEventListener("input", validateAccountUpdateForm);
    privateOwnerKey1Upd.addEventListener("input", validateAccountUpdateForm);
    privateOwnerKey2Upd.addEventListener("input", validateAccountUpdateForm);
    useTwoPublicOwnerKeysUpd.addEventListener("change", validateAccountUpdateForm);
    signWithTwoOwnerKeysUpd.addEventListener("change", validateAccountUpdateForm);

    
    if (submitButtonUpd) {
        submitButtonUpd.addEventListener("click", submitAccountUpdateTransaction);
    }

    
    validateAccountUpdateForm();

    
    async function submitAccountUpdateTransaction() {
        if (!accountNameUpd || !privateOwnerKey1Upd || !newPublicOwnerKey1Upd || !newPublicActiveKeyUpd || !resultMessageUpd) return;

        const accountName = accountNameUpd.value.trim();
        const privateOwnerKey1 = privateOwnerKey1Upd.value.trim();
        const privateOwnerKey2 = privateOwnerKey2Upd?.value.trim() || ""; 
        const newPublicOwnerKey1 = newPublicOwnerKey1Upd.value.trim();
        const newPublicOwnerKey2 = newPublicOwnerKey2Upd?.value.trim() || ""; 
        const newPublicActiveKey = newPublicActiveKeyUpd.value.trim();
        const newPublicPostingKey = newPublicPostingKeyUpd.value.trim();
        const newPublicMemoKey = newPublicMemoKeyUpd.value.trim();

        let ownerAuths;
        if (useTwoPublicOwnerKeysUpd.checked) {
            
            const sortedKeys = [newPublicOwnerKey1, newPublicOwnerKey2].sort((a, b) => {
                return a.localeCompare(b, undefined, { sensitivity: "base" });
            });

            ownerAuths = sortedKeys.map((key) => [key, 1]);
        } else {
            ownerAuths = [[newPublicOwnerKey1, 1]];
        }

        const op = [
            "account_update", {
                account: accountName,
                owner: {
                    account_auths: [],
                    key_auths: ownerAuths,
                    weight_threshold: useTwoPublicOwnerKeysUpd.checked ? 2 : 1
                },
                active: {
                    account_auths: [],
                    key_auths: [[newPublicActiveKey, 1]],
                    weight_threshold: 1
                },
                posting: {
                    account_auths: [],
                    key_auths: [[newPublicPostingKey, 1]],
                    weight_threshold: 1
                },
                memo_key: newPublicMemoKey,
                json_metadata: ""
            }
        ];

        try {
            const privateKeys = [dhive.PrivateKey.fromString(privateOwnerKey1)];
            if (signWithTwoOwnerKeysUpd.checked) {
                privateKeys.push(dhive.PrivateKey.fromString(privateOwnerKey2));
            }
            const result = await client.broadcast.sendOperations([op], privateKeys);
            resultMessageUpd.textContent = "Transaction successfully broadcast: " + JSON.stringify(result);
            resultMessageUpd.style.color = "green";
        } catch (error) {
            resultMessageUpd.textContent = "Error broadcasting transaction: " + error.message;
            resultMessageUpd.style.color = "red";
        } finally {
            
            if (privateOwnerKey1Upd) privateOwnerKey1Upd.value = "";
            if (privateOwnerKey2Upd) privateOwnerKey2Upd.value = "";
            validateAccountUpdateForm();
        }
    }


    
    
    function validateChangeRecoveryTool() {
        const accountName = accountNameChgRec.value.trim();
        const newRecoveryAccount = newRecoveryAccountChgRec.value.trim();
        const privateOwnerKey1 = privateOwnerKey1ChgRec.value.trim();
        const privateOwnerKey2 = privateOwnerKey2ChgRec?.value.trim() || ""; 

        
        const isAccountNameValid = accountName && validateAccountNameStructure(accountName);
        const isNewRecoveryAccountValid = newRecoveryAccount && validateAccountNameStructure(newRecoveryAccount);
        const areAccountsDifferent = accountName !== newRecoveryAccount;

        
        let arePrivateKeysValid = true;
        if (signWithTwoOwnerKeysChgRec.checked) {
            
            arePrivateKeysValid = privateOwnerKey2 && privateOwnerKey2 !== privateOwnerKey1;
        }

        
        let isFormValidChgRec = isAccountNameValid && isNewRecoveryAccountValid && areAccountsDifferent && privateOwnerKey1 && arePrivateKeysValid;

        
        submitButtonChgRec.disabled = !isFormValidChgRec;
    }

    
    if (signWithTwoOwnerKeysChgRec) {
        signWithTwoOwnerKeysChgRec.addEventListener("change", () => {
            if (secondPrivateKeyGroupChgRec) {
                secondPrivateKeyGroupChgRec.style.display = signWithTwoOwnerKeysChgRec.checked ? "block" : "none";
            }
            if (privateOwnerKey2ChgRec) privateOwnerKey2ChgRec.value = "";
            validateChangeRecoveryTool(); 
        });
    }

    
    accountNameChgRec.addEventListener("input", () => validateAccountInput(accountNameChgRec, submitButtonChgRec));
    newRecoveryAccountChgRec.addEventListener("input", () => validateAccountInput(newRecoveryAccountChgRec, submitButtonChgRec));

    
    accountNameChgRec.addEventListener("input", validateChangeRecoveryTool);
    newRecoveryAccountChgRec.addEventListener("input", validateChangeRecoveryTool);
    privateOwnerKey1ChgRec.addEventListener("input", validateChangeRecoveryTool);
    privateOwnerKey2ChgRec.addEventListener("input", validateChangeRecoveryTool);
    signWithTwoOwnerKeysChgRec.addEventListener("change", validateChangeRecoveryTool);

    
    if (submitButtonChgRec) {
        submitButtonChgRec.addEventListener("click", submitTransactionChgRec);
    }

    
    validateChangeRecoveryTool();

    
    async function submitTransactionChgRec() {
        if (!accountNameChgRec || !newRecoveryAccountChgRec || !privateOwnerKey1ChgRec || !resultMessageChgRec) return;

        const accountName = accountNameChgRec.value.trim();
        const newRecoveryAccount = newRecoveryAccountChgRec.value.trim();
        const privateOwnerKey1 = privateOwnerKey1ChgRec.value.trim();
        const privateOwnerKey2 = privateOwnerKey2ChgRec?.value.trim() || ""; 

        const op = [
            "change_recovery_account", {
                account_to_recover: accountName,
                extensions: [],
                new_recovery_account: newRecoveryAccount
            }
        ];

        try {
            const privateKeys = [dhive.PrivateKey.fromString(privateOwnerKey1)];
            if (signWithTwoOwnerKeysChgRec.checked) {
                privateKeys.push(dhive.PrivateKey.fromString(privateOwnerKey2));
            }
            const result = await client.broadcast.sendOperations([op], privateKeys);

            resultMessageChgRec.textContent = "Transaction successfully broadcast: " + JSON.stringify(result);
            resultMessageChgRec.style.color = "green";
        } catch (error) {
            resultMessageChgRec.textContent = "Error broadcasting transaction: " + error.message;
            resultMessageChgRec.style.color = "red";
        } finally {
            
            if (privateOwnerKey1ChgRec) privateOwnerKey1ChgRec.value = "";
            if (privateOwnerKey2ChgRec) privateOwnerKey2ChgRec.value = "";
            validateChangeRecoveryTool();
        }
    }


    
    
    function validateExecuteRecoveryTool() {
        const accountName = accountNameExecRec.value.trim();
        const newPrivateOwnerKey = newPrivateOwnerKeyExecRec.value.trim();
        const previousPrivateOwnerKey1 = previousPrivateOwnerKey1ExecRec.value.trim();
        const previousPrivateOwnerKey2 = previousPrivateOwnerKey2ExecRec?.value.trim() || ""; 

        
        const isAccountNameValid = accountName && validateAccountNameStructure(accountName);

        
        let arePrivateKeysValid = newPrivateOwnerKey && previousPrivateOwnerKey1;

        
        if (signWithTwoOwnerKeysExecRec.checked) {
            arePrivateKeysValid = arePrivateKeysValid &&
                previousPrivateOwnerKey2 &&
                previousPrivateOwnerKey2 !== previousPrivateOwnerKey1;
        }

        
        submitButtonExecRec.disabled = !(isAccountNameValid && arePrivateKeysValid);
    }

    
    if (signWithTwoOwnerKeysExecRec) {
        signWithTwoOwnerKeysExecRec.addEventListener("change", () => {
            if (secondPrivateKeyGroupExecRec) {
                secondPrivateKeyGroupExecRec.style.display = signWithTwoOwnerKeysExecRec.checked ? "block" : "none";
            }
            if (previousPrivateOwnerKey2ExecRec) previousPrivateOwnerKey2ExecRec.value = "";
            validateExecuteRecoveryTool(); 
        });
    }

    
    accountNameExecRec.addEventListener("input", () => validateAccountInput(accountNameExecRec, submitButtonExecRec));

    
    const inputFieldsExecRec = [
        accountNameExecRec,
        newPrivateOwnerKeyExecRec,
        previousPrivateOwnerKey1ExecRec,
        previousPrivateOwnerKey2ExecRec,
        signWithTwoOwnerKeysExecRec
    ];
    inputFieldsExecRec.forEach(field => field?.addEventListener("input", validateExecuteRecoveryTool));

    
    if (submitButtonExecRec) {
        submitButtonExecRec.addEventListener("click", submitTransactionExecRec);
    }

    
    validateExecuteRecoveryTool();

    
    async function submitTransactionExecRec() {
        if (!accountNameExecRec || !newPrivateOwnerKeyExecRec || !previousPrivateOwnerKey1ExecRec || !resultMessageExecRec) return;

        const accountName = accountNameExecRec.value.trim();
        const newPrivateOwnerKey = newPrivateOwnerKeyExecRec.value.trim();
        const previousPrivateOwnerKey1 = previousPrivateOwnerKey1ExecRec.value.trim();
        const previousPrivateOwnerKey2 = previousPrivateOwnerKey2ExecRec?.value.trim() || ""; 

        let newPublicOwnerKey, previousPublicOwnerKey1, previousPublicOwnerKey2;
        try {
            
            newPublicOwnerKey = dhive.PrivateKey.fromString(newPrivateOwnerKey).createPublic().toString();
            previousPublicOwnerKey1 = dhive.PrivateKey.fromString(previousPrivateOwnerKey1).createPublic().toString();
            previousPublicOwnerKey2 = previousPrivateOwnerKey2
                ? dhive.PrivateKey.fromString(previousPrivateOwnerKey2).createPublic().toString()
                : null;

        } catch (error) {
            resultMessageExecRec.textContent = "Error: an invalid private key was entered.";
            resultMessageExecRec.style.color = "red";

            
            if (newPrivateOwnerKeyExecRec) newPrivateOwnerKeyExecRec.value = "";
            if (previousPrivateOwnerKey1ExecRec) previousPrivateOwnerKey1ExecRec.value = "";
            if (previousPrivateOwnerKey2ExecRec) previousPrivateOwnerKey2ExecRec.value = "";
            validateExecuteRecoveryTool();
            return; 
        }

        const newOwnerAuthority = {
            account_auths: [],
            key_auths: [[newPublicOwnerKey, 1]],
            weight_threshold: 1
        };

        let recentOwnerAuthority;
        if (signWithTwoOwnerKeysExecRec.checked) {
            
            const sortedPublicKeys = [previousPublicOwnerKey1, previousPublicOwnerKey2]
                .filter(Boolean) 
                .sort((a, b) => a.localeCompare(b, undefined, { sensitivity: "base" }));

            recentOwnerAuthority = {
                account_auths: [],
                key_auths: [
                    [sortedPublicKeys[0], 1],
                    [sortedPublicKeys[1], 1]
                ],
                weight_threshold: 2
            };
        } else {
            recentOwnerAuthority = {
                account_auths: [],
                key_auths: [[previousPublicOwnerKey1, 1]],
                weight_threshold: 1
            };
        }

        const op = [
            "recover_account", {
                account_to_recover: accountName,
                new_owner_authority: newOwnerAuthority,
                recent_owner_authority: recentOwnerAuthority,
                extensions: []
            }
        ];

        if (!newPublicOwnerKey || !previousPublicOwnerKey1 || (signWithTwoOwnerKeysExecRec.checked && !previousPublicOwnerKey2)) {
            resultMessageExecRec.textContent = "Error: failed to derive public keys.";
            resultMessageExecRec.style.color = "red";

            
            if (newPrivateOwnerKeyExecRec) newPrivateOwnerKeyExecRec.value = "";
            if (previousPrivateOwnerKey1ExecRec) previousPrivateOwnerKey1ExecRec.value = "";
            if (previousPrivateOwnerKey2ExecRec) previousPrivateOwnerKey2ExecRec.value = "";
            validateExecuteRecoveryTool();
            return;  
        }

        try {
            const privateKeys = [
                dhive.PrivateKey.fromString(newPrivateOwnerKey),
                dhive.PrivateKey.fromString(previousPrivateOwnerKey1)
            ];
            if (signWithTwoOwnerKeysExecRec.checked) {
                privateKeys.push(dhive.PrivateKey.fromString(previousPrivateOwnerKey2));
            }
            const result = await client.broadcast.sendOperations([op], privateKeys);
            resultMessageExecRec.textContent = "Transaction successfully broadcast: " + JSON.stringify(result);
            resultMessageExecRec.style.color = "green";
        } catch (error) {
            resultMessageExecRec.textContent = "Error broadcasting transaction: " + error.message;
            resultMessageExecRec.style.color = "red";
        } finally {
            
            if (newPrivateOwnerKeyExecRec) newPrivateOwnerKeyExecRec.value = "";
            if (previousPrivateOwnerKey1ExecRec) previousPrivateOwnerKey1ExecRec.value = "";
            if (previousPrivateOwnerKey2ExecRec) previousPrivateOwnerKey2ExecRec.value = "";
            validateExecuteRecoveryTool();
        }
    }


    
    
    function validateToolLock() {
        const accountName = accountNameLock.value.trim();
        const privateOwnerKey1 = privateOwnerKey1Lock.value.trim();
        const privateOwnerKey2 = privateOwnerKey2Lock?.value.trim() || ""; 
        const isExplicitlyConfirmed = explicitConfirmationLock.checked;

        
        const isAccountNameValid = accountName && validateAccountNameStructure(accountName);

        
        let arePrivateKeysValid = true;
        if (signWithTwoOwnerKeysLock.checked) {
            
            arePrivateKeysValid = privateOwnerKey2 && privateOwnerKey2 !== privateOwnerKey1;
        }

        
        let isFormValid = isAccountNameValid && privateOwnerKey1 && arePrivateKeysValid && isExplicitlyConfirmed;

        
        submitButtonLock.disabled = !isFormValid;
    }

    
    if (signWithTwoOwnerKeysLock) {
        signWithTwoOwnerKeysLock.addEventListener("change", () => {
            if (secondPrivateKeyGroupLock) {
                secondPrivateKeyGroupLock.style.display = signWithTwoOwnerKeysLock.checked ? "block" : "none";
            }
            if (privateOwnerKey2Lock) privateOwnerKey2Lock.value = "";
            validateToolLock(); 
        });
    }

    
    accountNameLock.addEventListener("input", () => validateAccountInput(accountNameLock, submitButtonLock));

    
    accountNameLock.addEventListener("input", validateToolLock);
    privateOwnerKey1Lock.addEventListener("input", validateToolLock);
    privateOwnerKey2Lock.addEventListener("input", validateToolLock);
    explicitConfirmationLock.addEventListener("change", validateToolLock);

    
    if (submitButtonLock) {
        submitButtonLock.addEventListener("click", submitTransactionLock);
    }

    
    validateToolLock();

    
    async function submitTransactionLock() {
        if (!accountNameLock || !privateOwnerKey1Lock || !resultMessageLock) return;

        const accountName = accountNameLock.value.trim();
        const privateOwnerKey1 = privateOwnerKey1Lock.value.trim();
        const privateOwnerKey2 = privateOwnerKey2Lock?.value.trim() || ""; 

        const [accountData] = await client.database.getAccounts([accountName]);
        const currentMemoKey = accountData?.memo_key || "";

        if (!currentMemoKey) {
            resultMessageLock.textContent = "Error: failed to fetch this account's data.";
            resultMessageLock.style.color = "red";
            if (explicitConfirmationLock) explicitConfirmationLock.checked = false;
            if (privateOwnerKey1Lock) privateOwnerKey1Lock.value = "";
            if (privateOwnerKey2Lock) privateOwnerKey2Lock.value = "";
            validateToolLock();
            return; 
        }

        const op = [
            "account_update", {
                account: accountName,
                owner: {
                    account_auths: [],
                    key_auths: [],
                    weight_threshold: 9999
                },
                active: {
                    account_auths: [],
                    key_auths: [],
                    weight_threshold: 9999
                },
                posting: {
                    account_auths: [],
                    key_auths: [],
                    weight_threshold: 9999
                },
                memo_key: currentMemoKey,
                json_metadata: ""
            }
        ];

        try {
            const privateKeys = [dhive.PrivateKey.fromString(privateOwnerKey1)];
            if (signWithTwoOwnerKeysLock.checked) {
                privateKeys.push(dhive.PrivateKey.fromString(privateOwnerKey2));
            }
            const result = await client.broadcast.sendOperations([op], privateKeys);

            resultMessageLock.textContent = "Transaction successfully broadcast: " + JSON.stringify(result);
            resultMessageLock.style.color = "green";
        } catch (error) {
            resultMessageLock.textContent = "Error broadcasting transaction: " + error.message;
            resultMessageLock.style.color = "red";
        } finally {
            if (explicitConfirmationLock) explicitConfirmationLock.checked = false;
            if (privateOwnerKey1Lock) privateOwnerKey1Lock.value = "";
            if (privateOwnerKey2Lock) privateOwnerKey2Lock.value = "";
            validateToolLock();
        }
    }


});



function clearInputs() {

    
    const accountNameUpd = document.getElementById("accountNameUpd");
    const newPublicOwnerKey1Upd = document.getElementById("newPublicOwnerKey1Upd");
    const useTwoPublicOwnerKeysUpd = document.getElementById("useTwoPublicOwnerKeysUpd");
    const newPublicOwnerKey2Upd = document.getElementById("newPublicOwnerKey2Upd");
    const secondPublicOwnerKeyGroupUpd = document.getElementById("secondPublicOwnerKeyGroupUpd");
    const newPublicActiveKeyUpd = document.getElementById("newPublicActiveKeyUpd");
    const newPublicPostingKeyUpd = document.getElementById("newPublicPostingKeyUpd");
    const newPublicMemoKeyUpd = document.getElementById("newPublicMemoKeyUpd");
    const privateOwnerKey1Upd = document.getElementById("privateOwnerKey1Upd");
    const signWithTwoOwnerKeysUpd = document.getElementById("signWithTwoOwnerKeysUpd");
    const privateOwnerKey2Upd = document.getElementById("privateOwnerKey2Upd");
    const secondPrivateKeyGroupUpd = document.getElementById("secondPrivateKeyGroupUpd");
    const submitButtonUpd = document.getElementById("submitButtonUpd");
    const resultMessageUpd = document.getElementById("resultMessageUpd");

    if (accountNameUpd) accountNameUpd.value = "";
    if (accountNameUpd) accountNameUpd.style.borderColor = "";
    if (newPublicOwnerKey1Upd) newPublicOwnerKey1Upd.value = "";
    if (useTwoPublicOwnerKeysUpd) useTwoPublicOwnerKeysUpd.checked = false;
    if (newPublicOwnerKey2Upd) newPublicOwnerKey2Upd.value = "";
    if (secondPublicOwnerKeyGroupUpd) secondPublicOwnerKeyGroupUpd.style.display = "none";
    if (newPublicActiveKeyUpd) newPublicActiveKeyUpd.value = "";
    if (newPublicPostingKeyUpd) newPublicPostingKeyUpd.value = "";
    if (newPublicMemoKeyUpd) newPublicMemoKeyUpd.value = "";
    if (privateOwnerKey1Upd) privateOwnerKey1Upd.value = "";
    if (signWithTwoOwnerKeysUpd) signWithTwoOwnerKeysUpd.checked = false;
    if (privateOwnerKey2Upd) privateOwnerKey2Upd.value = "";
    if (secondPrivateKeyGroupUpd) secondPrivateKeyGroupUpd.style.display = "none";
    if (submitButtonUpd) submitButtonUpd.disabled = true;
    if (resultMessageUpd) resultMessageUpd.textContent = "";

    
    const accountNameChgRec = document.getElementById("accountNameChgRec");
    const newRecoveryAccountChgRec = document.getElementById("newRecoveryAccountChgRec");
    const privateOwnerKey1ChgRec = document.getElementById("privateOwnerKey1ChgRec");
    const signWithTwoOwnerKeysChgRec = document.getElementById("signWithTwoOwnerKeysChgRec");
    const privateOwnerKey2ChgRec = document.getElementById("privateOwnerKey2ChgRec");
    const secondPrivateKeyGroupChgRec = document.getElementById("secondPrivateKeyGroupChgRec");
    const submitButtonChgRec = document.getElementById("submitButtonChgRec");
    const resultMessageChgRec = document.getElementById("resultMessageChgRec");

    if (accountNameChgRec) accountNameChgRec.value = "";
    if (accountNameChgRec) accountNameChgRec.style.borderColor = "";
    if (newRecoveryAccountChgRec) newRecoveryAccountChgRec.value = "";
    if (newRecoveryAccountChgRec) newRecoveryAccountChgRec.style.borderColor = "";
    if (privateOwnerKey1ChgRec) privateOwnerKey1ChgRec.value = "";
    if (signWithTwoOwnerKeysChgRec) signWithTwoOwnerKeysChgRec.checked = false;
    if (privateOwnerKey2ChgRec) privateOwnerKey2ChgRec.value = "";
    if (secondPrivateKeyGroupChgRec) secondPrivateKeyGroupChgRec.style.display = "none";
    if (submitButtonChgRec) submitButtonChgRec.disabled = true;
    if (resultMessageChgRec) resultMessageChgRec.textContent = "";

    
    const accountNameExecRec = document.getElementById("accountNameExecRec");
    const newPrivateOwnerKeyExecRec = document.getElementById("newPrivateOwnerKeyExecRec");
    const previousPrivateOwnerKey1ExecRec = document.getElementById("previousPrivateOwnerKey1ExecRec");
    const previousPrivateOwnerKey2ExecRec = document.getElementById("previousPrivateOwnerKey2ExecRec");
    const signWithTwoOwnerKeysExecRec = document.getElementById("signWithTwoOwnerKeysExecRec");
    const secondPrivateKeyGroupExecRec = document.getElementById("secondPrivateKeyGroupExecRec");
    const submitButtonExecRec = document.getElementById("submitButtonExecRec");
    const resultMessageExecRec = document.getElementById("resultMessageExecRec");

    if (accountNameExecRec) accountNameExecRec.value = "";
    if (accountNameExecRec) accountNameExecRec.style.borderColor = "";
    if (newPrivateOwnerKeyExecRec) newPrivateOwnerKeyExecRec.value = "";
    if (previousPrivateOwnerKey1ExecRec) previousPrivateOwnerKey1ExecRec.value = "";
    if (previousPrivateOwnerKey2ExecRec) previousPrivateOwnerKey2ExecRec.value = "";
    if (signWithTwoOwnerKeysExecRec) signWithTwoOwnerKeysExecRec.checked = false;
    if (secondPrivateKeyGroupExecRec) secondPrivateKeyGroupExecRec.style.display = "none";
    if (submitButtonExecRec) submitButtonExecRec.disabled = true;
    if (resultMessageExecRec) resultMessageExecRec.textContent = "";

    
    const accountNameLock = document.getElementById("accountNameLock");
    const privateOwnerKey1Lock = document.getElementById("privateOwnerKey1Lock");
    const signWithTwoOwnerKeysLock = document.getElementById("signWithTwoOwnerKeysLock");
    const secondPrivateKeyGroupLock = document.getElementById("secondPrivateKeyGroupLock");
    const privateOwnerKey2Lock = document.getElementById("privateOwnerKey2Lock");
    const explicitConfirmationLock = document.getElementById("explicitConfirmationLock");
    const submitButtonLock = document.getElementById("submitButtonLock");
    const resultMessageLock = document.getElementById("resultMessageLock");

    if (accountNameLock) accountNameLock.value = "";
    if (accountNameLock) accountNameLock.style.borderColor = "";
    if (privateOwnerKey1Lock) privateOwnerKey1Lock.value = "";
    if (signWithTwoOwnerKeysLock) signWithTwoOwnerKeysLock.checked = false;
    if (secondPrivateKeyGroupLock) secondPrivateKeyGroupLock.style.display = "none";
    if (privateOwnerKey2Lock) privateOwnerKey2Lock.value = "";
    if (explicitConfirmationLock) explicitConfirmationLock.checked = false;
    if (submitButtonLock) submitButtonLock.disabled = true;
    if (resultMessageLock) resultMessageLock.textContent = "";

}



function showPage(pageId) {

    
    if (pageId === "mainMenu") {
        if (typeof clearInputs === "function") {
            clearInputs(); 
        }
    }

    
    document.getElementById("mainMenu").style.display = "none";
    document.getElementById("accountUpdateTool").style.display = "none";
    document.getElementById("changeRecoveryTool").style.display = "none";
    document.getElementById("executeRecoveryTool").style.display = "none";
    document.getElementById("irreversibleLockTool").style.display = "none";

    
    document.getElementById(pageId).style.display = "block";
}

     
    
    </script>

</head>

<body>

    <div id="mainMenu">
        <h1>Owner Operations Toolbox</h1>
        <p class="subtitle">• These tools require internet connectivity, in order to broadcast transactions to the Hive blockchain</p>
        <p class="subtitle">• All these operations require signing with Owner Authority</p>
        <p class="subtitle">• For other operation types, check my <a href="https://hassemer-g.github.io/hive-ops/" target="_blank">Non-Owner Operations Toolbox</a></p>
        <button class="button" onclick="showPage('accountUpdateTool')">Change Account Keys</button>
        <button class="button" onclick="showPage('changeRecoveryTool')">Change Recovery Account</button>
        <button class="button" onclick="showPage('executeRecoveryTool')">Execute Account Recovery</button>
        <button class="button" onclick="showPage('irreversibleLockTool')" style="background-color: red; color: white">Lock Account Forever</button>
        <p class="footer">Made with ❤️ by <a href="https://peakd.com/@hassemer" target="_blank">@hassemer</a></p>
        <p class="footer">v. 1.2</p>
        <br><br>
        <h1>My Little Hive Tools</h1>
        <p class="subtitle"><a href="https://hassemer-g.github.io/hive-keys/" target="_blank">Key Derivation Toolbox</a></p>
        <p class="subtitle"><b>Owner Operations Toolbox</b></p>
        <p class="subtitle"><a href="https://hassemer-g.github.io/hive-ops/" target="_blank">Non-Owner Operations Toolbox</a></p>
        <br>
        <p class="disclaimer"><b>Disclaimer:</b> These tools are provided "as-is", absolutely without guarantees. <span class="highlight">Use them at your own risk.</span> Please be careful 🙏🏻</p>
    </div>


    <div id="accountUpdateTool" class="hidden">
        <h1>Change Account Keys</h1>
        <p class="subtitle">• This tool can change your Hive account's keys</p>
         <p class="subtitle">• Before using this tool, you can use my <a href="https://hassemer-g.github.io/hive-keys/" target="_blank">Key Derivation Toolbox</a> to generate a random "Master Password" and derive your new keys</p>
        <div class="form-group">
            <label for="accountNameUpd">Your Hive Account:</label>
            <input type="text" id="accountNameUpd" placeholder="E.g., youraccount">
        </div>
        <div class="form-group">
            <label for="newPublicOwnerKey1Upd">New Public Owner Key:</label>
            <input type="text" id="newPublicOwnerKey1Upd" placeholder="New Public Owner Key (STM...)">
            <div class="checkbox-container">
                <input type="checkbox" id="useTwoPublicOwnerKeysUpd">
                <br>
                <label for="useTwoPublicOwnerKeysUpd">Use two owner keys to compose the new owner authority</label>
            </div>
        </div>
        <div class="form-group" id="secondPublicOwnerKeyGroupUpd" style="display: none;">
            <label for="newPublicOwnerKey2Upd">Second New Public Owner Key:</label>
            <input type="text" id="newPublicOwnerKey2Upd" placeholder="Second New Public Owner Key (STM...)">
        </div>
        <div class="form-group">
            <label for="newPublicActiveKeyUpd">New Public Active Key:</label>
            <input type="text" id="newPublicActiveKeyUpd" placeholder="New Public Active Key (STM...)">
        </div>
        <div class="form-group">
            <label for="newPublicPostingKeyUpd">New Public Posting Key:</label>
            <input type="text" id="newPublicPostingKeyUpd" placeholder="New Public Posting Key (STM...)">
        </div>
        <div class="form-group">
            <label for="newPublicMemoKeyUpd">New Public Memo Key:</label>
            <input type="text" id="newPublicMemoKeyUpd" placeholder="New Public Memo Key (STM...)">
        </div>
        <div class="form-group">
            <label for="privateOwnerKey1Upd">Current Private Owner Key:</label>
            <input type="password" id="privateOwnerKey1Upd" placeholder="Private Owner Key (5...)">
            <div class="checkbox-container">
                <input type="checkbox" id="signWithTwoOwnerKeysUpd">
                <br>
                <label for="signWithTwoOwnerKeysUpd">Sign the transaction with two owner keys</label>
            </div>
        </div>
        <div class="form-group" id="secondPrivateKeyGroupUpd" style="display: none;">
            <label for="privateOwnerKey2Upd">Second Private Owner Key:</label>
            <input type="password" id="privateOwnerKey2Upd" placeholder="Second Private Owner Key (5...)">
        </div>
        <button id="submitButtonUpd" disabled>Submit Transaction</button>
        <p id="resultMessageUpd"></p>
        <button class="button" onclick="showPage('mainMenu')">Return to Main Menu</button>
    </div>


    <div id="changeRecoveryTool" class="hidden">
        <h1>Change Recovery Account</h1>
        <p class="subtitle">• This tool can change your Hive account's Recovery Account</p>
        <p class="subtitle">• The change of recovery account takes place 30 days after this operation is broadcast</p>
        <p class="subtitle">• I recommend changing your account's keys right after using this tool, because this operation requires signing with Owner Authority</p>
        <div class="form-group">
            <label for="accountNameChgRec">Your Hive Account:</label>
            <input type="text" id="accountNameChgRec" placeholder="E.g., youraccount">
        </div>
        <div class="form-group">
            <label for="newRecoveryAccountChgRec">New Recovery Account:</label>
            <input type="text" id="newRecoveryAccountChgRec" placeholder="E.g., recoveryaccount">
        </div>
        <div class="form-group">
            <label for="privateOwnerKey1ChgRec">Your Private Owner Key:</label>
            <input type="password" id="privateOwnerKey1ChgRec" placeholder="Private Owner Key (5...)">
            <div class="checkbox-container">
                <input type="checkbox" id="signWithTwoOwnerKeysChgRec">
                <br>
                <label for="signWithTwoOwnerKeysChgRec">Sign the transaction with two owner keys</label>
            </div>
        </div>
        <div class="form-group" id="secondPrivateKeyGroupChgRec" style="display: none;">
            <label for="privateOwnerKey2ChgRec">Second Private Owner Key:</label>
            <input type="password" id="privateOwnerKey2ChgRec" placeholder="Second Private Owner Key (5...)">
        </div>
        <button id="submitButtonChgRec" disabled>Submit Transaction</button>
        <p id="resultMessageChgRec"></p>
        <button class="button" onclick="showPage('mainMenu')">Return to Main Menu</button>
    </div>


    <div id="executeRecoveryTool" class="hidden">
        <h1>Execute Account Recovery</h1>
        <p class="subtitle">• This tool can conclude the recovery process of a Hive account</p>
        <p class="subtitle">• Before using this tool, your Recovery Account must broadcast a Recovery Request operation (this can be done using my <a href="https://hassemer-g.github.io/hive-ops/" target="_blank">Non-Owner Operations Toolbox</a>)</p>
        <p class="subtitle">• Your "New Private Owner Key" must match the "New Public Owner Key" specified in the Recovery Request broadcast by your Recovery Account</p>
        <p class="subtitle">• The previous Owner Key(s) used for recovery must not be older than 30 days!</p>
        <p class="subtitle">• I recommend changing your account's keys right after completing the recovery process (use my "Change Account Keys" tool)</p>
        <div class="form-group">
            <label for="accountNameExecRec">Your Hive Account:</label>
            <input type="text" id="accountNameExecRec" placeholder="E.g., youraccount">
        </div>
        <div class="form-group">
            <label for="newPrivateOwnerKeyExecRec">New Private Owner Key:</label>
            <input type="password" id="newPrivateOwnerKeyExecRec" placeholder="New Private Owner Key (5...)">
        </div>
        <div class="form-group">
            <label for="previousPrivateOwnerKey1ExecRec">Previous Private Owner Key:</label>
            <input type="password" id="previousPrivateOwnerKey1ExecRec" placeholder="Previous Private Owner Key (5...)">
            <div class="checkbox-container">
                <input type="checkbox" id="signWithTwoOwnerKeysExecRec">
                <br>
                <label for="signWithTwoOwnerKeysExecRec">The previous owner authority had two owner keys</label>
            </div>
        </div>
        <div class="form-group" id="secondPrivateKeyGroupExecRec" style="display: none;">
            <label for="previousPrivateOwnerKey2ExecRec">Second Previous Private Owner Key:</label>
            <input type="password" id="previousPrivateOwnerKey2ExecRec" placeholder="Second Previous Private Owner Key (5...)">
        </div>
        <button id="submitButtonExecRec" disabled>Submit Transaction</button>
        <p id="resultMessageExecRec"></p>
        <button class="button" onclick="showPage('mainMenu')">Return to Main Menu</button>
    </div>


    <div id="irreversibleLockTool" class="hidden">
        <h1>Lock Account Forever</h1>
        <p class="subtitle">• This tool can permanently lock your Hive account</p>
        <p class="subtitle">• This will ensure that, once the account is "locked", no one will be able to perform any action with this account, even if one day it becomes computationally feasible to brute-force Hive keys</p>
        <p class="subtitle">• Any assets controlled by this account will effectively be lost forever</p>
        <p class="subtitle">• Note that the "locked" account can still be recovered during the next 30 days after this operation is broadcast</p>
        <div class="form-group">
            <label for="accountNameLock">Your Hive Account:</label>
            <input type="text" id="accountNameLock" placeholder="E.g., youraccount">
        </div>
        <div class="form-group">
            <label for="privateOwnerKey1Lock">Your Private Owner Key:</label>
            <input type="password" id="privateOwnerKey1Lock" placeholder="Private Owner Key (5...)">
            <div class="checkbox-container">
                <input type="checkbox" id="signWithTwoOwnerKeysLock">
                <label for="signWithTwoOwnerKeysLock">Sign the transaction with two owner keys</label>
            </div>
        </div>
        <div class="form-group" id="secondPrivateKeyGroupLock" style="display: none;">
            <label for="privateOwnerKey2Lock">Second Private Owner Key:</label>
            <input type="password" id="privateOwnerKey2Lock" placeholder="Second Private Owner Key (5...)">
        </div>
        <div class="checkbox-container">
            <input type="checkbox" id="explicitConfirmationLock">
            <label for="explicitConfirmationLock" style="color: red">Yes, I want to lock my account forever!</label>
            <br><br>
        </div>
        <button id="submitButtonLock" disabled>Submit Transaction</button>
        <p id="resultMessageLock"></p>
        <button class="button" onclick="showPage('mainMenu')">Return to Main Menu</button>
    </div>

</body>
    
</html>
